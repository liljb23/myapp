import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import * as SecureStore from 'expo-secure-store';

// ✅ Load the last used language
const getStoredLanguage = async () => {
  try {
    const storedLanguage = await SecureStore.getItemAsync('appLanguage');
    return storedLanguage || 'en';
  } catch (error) {
    console.error('Error getting stored language:', error);
    return 'en';
  }
};

// ✅ Translations
const resources = {
  en: {
    translation: {
      "home": "Home",
      "settings": "Settings",
      "searchPlaceholder": "Search...",
      "login": "Login",
      "register": "Register",
      "helloUser": "Hello, {{name}}",
      "recommends": "Recommends",
      "seeAll": "See all",
      "categories": "Categories",
      "restaurant": "Restaurant",
      "beautyAndSalon": "Beauty & Salon",
      "resortAndHotel": "Resort & Hotel",
      "touristAttraction": "Tourist Attraction",
      "mosque": "Mosque",
      "blog": "Blog",
      "mosqueNearYou": "Mosque near you",
      "touristAttractions": "Tourist attractions",
      "prayerPlacesNearYou": "Places of prayer near you",
      "discountsAndBenefits": "Discounts and benefits",
      "discount": "Discount",
      "readMore": "Read More",
      "aboutUs": "About Us",
      "reviews": "{{count}} Reviews",
      "discountAmount": "Discount {{amount}}",
      "expiresIn": "Expires in {{date}}",
      "discountUsed": "Discount Used",
      "useDiscount": "Use Discount",
      "sortBy": "Sort by: {{province}}",
      "nearMe": "Near me",
      "details": "Details",
      "directions": "Directions",
      "selectProvince": "Select Province",
      "selectCategory": "Select Category",
      "confirm": "Confirm",
      "noResultsFound": "No results found.",
      "beautySalon": "Beauty & Salon",
      "resortHotel": "Resort & Hotel",
      "prayerSpace": "Prayer Space",
      "ramadanGuideTitle": "A Complete Guide to Ramadan",
      "ramadanGuideDescription": "Learn about dates, traditions, and preparing for the holy month",
      "ramadan2025": "Ramadan 2025",
      "editProfile": "Edit Profile",
      "favorites": "Favorites",
      "changeLanguage": "Change Language",
      "helpCenter": "Help Center",
      "logout": "Logout",
      "deleteAccount": "Delete Account",
      "logoutConfirmation": "Do you want to Logout?",
      "yesLogout": "Yes, Logout",
      "cancel": "Cancel",
      "confirmDeleteAccountTitle": "Confirm Delete Account",
      "confirmDeleteAccountMessage": "Are you sure you want to delete your account?",
      "delete": "Delete",
      "hello": "Hello,",
      "error": "Error",
      "errorFailedToLoadUserData": "Failed to load user data",
      "errorFailedToPickImage": "Failed to pick image",
      "errorFailedToUploadImage": "Failed to upload image",
      "errorPleaseEnterDisplayName": "Please enter a display name",
      "success": "Success",
      "successProfileUpdated": "Profile updated successfully",
      "errorFailedToUpdateProfile": "Failed to update profile",
      "displayName": "Display Name",
      "placeholderEnterYourName": "Enter your name",
      "email": "Email",
      "phone": "Phone",
      "placeholderEnterPhoneNumber": "Enter your phone number",
      "saveChanges": "Save Changes",
      "languageThai": "ไทย (Thai)",
      "languageEnglish": "English",
      "languageArabic": "العربية (Arabic)",
      "errorChangingLanguage": "Error changing language"
    }
  },
  th: {
    translation: {
      "home": "หน้าแรก",
      "settings": "การตั้งค่า",
      "searchPlaceholder": "ค้นหา...",
      "login": "เข้าสู่ระบบ",
      "register": "สมัครสมาชิก",
      "helloUser": "สวัสดี, {{name}}",
      "recommends": "แนะนำ",
      "seeAll": "ดูทั้งหมด",
      "categories": "หมวดหมู่",
      "restaurant": "ร้านอาหาร",
      "beautyAndSalon": "เสริมสวยและซาลอน",
      "resortAndHotel": "รีสอร์ทและโรงแรม",
      "touristAttraction": "สถานที่ท่องเที่ยว",
      "mosque": "มัสยิด",
      "blog": "บล็อก",
      "mosqueNearYou": "มัสยิดใกล้คุณ",
      "touristAttractions": "สถานที่ท่องเที่ยว",
      "prayerPlacesNearYou": "สถานที่ละหมาดใกล้คุณ",
      "discountsAndBenefits": "ส่วนลดและสิทธิประโยชน์",
      "discount": "ส่วนลด",
      "readMore": "อ่านเพิ่มเติม",
      "aboutUs": "เกี่ยวกับเรา",
      "reviews": "{{count}} รีวิว",
      "discountAmount": "ส่วนลด {{amount}}",
      "expiresIn": "หมดอายุในวันที่ {{date}}",
      "discountUsed": "ใช้ส่วนลดแล้ว",
      "useDiscount": "ใช้ส่วนลด",
      "sortBy": "เรียงตาม: {{province}}",
      "nearMe": "ใกล้ฉัน",
      "details": "รายละเอียด",
      "directions": "เส้นทาง",
      "selectProvince": "เลือกจังหวัด",
      "selectCategory": "เลือกหมวดหมู่",
      "confirm": "ยืนยัน",
      "noResultsFound": "ไม่พบผลลัพธ์",
      "beautySalon": "ร้านเสริมสวย",
      "resortHotel": "รีสอร์ทและโรงแรม",
      "prayerSpace": "พื้นที่ละหมาด",
      "ramadanGuideTitle": "คู่มือเดือนรอมฎอนฉบับสมบูรณ์",
      "ramadanGuideDescription": "เรียนรู้เกี่ยวกับวันที่ ประเพณี และการเตรียมตัวสำหรับเดือนอันศักดิ์สิทธิ์",
      "ramadan2025": "รอมฎอน 2025",
      "editProfile": "แก้ไขโปรไฟล์",
      "favorites": "รายการโปรด",
      "changeLanguage": "เปลี่ยนภาษา",
      "helpCenter": "ศูนย์ช่วยเหลือ",
      "logout": "ออกจากระบบ",
      "deleteAccount": "ลบบัญชี",
      "logoutConfirmation": "คุณต้องการออกจากระบบหรือไม่?",
      "yesLogout": "ใช่, ออกจากระบบ",
      "cancel": "ยกเลิก",
      "confirmDeleteAccountTitle": "ยืนยันการลบบัญชี",
      "confirmDeleteAccountMessage": "คุณแน่ใจหรือไม่ว่าต้องการลบบัญชีของคุณ?",
      "delete": "ลบ",
      "hello": "สวัสดี",
      "error": "ข้อผิดพลาด",
      "errorFailedToLoadUserData": "ไม่สามารถโหลดข้อมูลผู้ใช้ได้",
      "errorFailedToPickImage": "ไม่สามารถเลือกรูปภาพได้",
      "errorFailedToUploadImage": "ไม่สามารถอัปโหลดรูปภาพได้",
      "errorPleaseEnterDisplayName": "กรุณาใส่ชื่อที่แสดง",
      "success": "สำเร็จ",
      "successProfileUpdated": "อัปเดตโปรไฟล์สำเร็จแล้ว",
      "errorFailedToUpdateProfile": "ไม่สามารถอัปเดตโปรไฟล์ได้",
      "displayName": "ชื่อที่แสดง",
      "placeholderEnterYourName": "ใส่ชื่อของคุณ",
      "email": "อีเมล",
      "phone": "โทรศัพท์",
      "placeholderEnterPhoneNumber": "ใส่หมายเลขโทรศัพท์ของคุณ",
      "saveChanges": "บันทึกการเปลี่ยนแปลง",
      "languageThai": "ไทย (Thai)",
      "languageEnglish": "English",
      "languageArabic": "العربية (Arabic)",
      "errorChangingLanguage": "เกิดข้อผิดพลาดในการเปลี่ยนภาษา"
    }
  },
  ar: {
    translation: {
      "home": "الصفحة الرئيسية",
      "settings": "الإعدادات",
      "searchPlaceholder": "بحث...",
      "login": "تسجيل الدخول",
      "register": "تسجيل",
      "helloUser": "مرحباً {{name}}",
      "recommends": "التوصيات",
      "seeAll": "عرض الكل",
      "categories": "الفئات",
      "restaurant": "مطعم",
      "beautyAndSalon": "تجميل وصالون",
      "resortAndHotel": "منتجع وفندق",
      "touristAttraction": "แหล่งท่องเที่ยว",
      "mosque": "مسجد",
      "blog": "مدونة",
      "mosqueNearYou": "مسجد بالقرب منك",
      "touristAttractions": "مناطق سياحية",
      "prayerPlacesNearYou": "أماكن صلاة بالقرب منك",
      "discountsAndBenefits": "الخصومات والفوائد",
      "discount": "خصم",
      "readMore": "اقرأ المزيد",
      "aboutUs": "من نحن",
      "reviews": "{{count}} مراجعات",
      "discountAmount": "خصم {{amount}}",
      "expiresIn": "ينتهي في {{date}}",
      "discountUsed": "تم استخدام الخصم",
      "useDiscount": "استخدام الخصم",
      "sortBy": "فرز حسب: {{province}}",
      "nearMe": "بالقرب مني",
      "details": "تفاصيل",
      "directions": "الاتجاهات",
      "selectProvince": "اختر المحافظة",
      "selectCategory": "اختر الفئة",
      "confirm": "تأكيد",
      "noResultsFound": "لم يتم العثور على نتائج.",
      "beautySalon": "صالون تجميل",
      "resortHotel": "منتجع وفندق",
      "prayerSpace": "مكان للصلاة",
      "ramadanGuideTitle": "دليل کامل لشهر رمضان",
      "ramadanGuideDescription": "تعرف على التواريخ والتقاليد والاستعداد للشهر الفضيل",
      "ramadan2025": "رمضان 2025",
      "editProfile": "تعديل الملف الشخصي",
      "favorites": "المفضلة",
      "changeLanguage": "تغيير اللغة",
      "helpCenter": "مركز المساعدة",
      "logout": "تسجيل الخروج",
      "deleteAccount": "حذف الحساب",
      "logoutConfirmation": "هل تريد تسجيل الخروج؟",
      "yesLogout": "نعم ، تسجيل الخروج",
      "cancel": "إلغاء",
      "confirmDeleteAccountTitle": "تأكيد حذف الحساب",
      "confirmDeleteAccountMessage": "هل أنت متأكد أنك تريد حذف حسابك؟",
      "delete": "حذف",
      "hello": "مرحباً",
      "error": "خطأ",
      "errorFailedToLoadUserData": "فشل تحميل بيانات المستخدم",
      "errorFailedToPickImage": "فشل اختيار الصورة",
      "errorFailedToUploadImage": "فشل تحميل الصورة",
      "errorPleaseEnterDisplayName": "الرجاء إدخال اسم العرض",
      "success": "نجاح",
      "successProfileUpdated": "تم تحديث الملف الشخصي بنجاح",
      "errorFailedToUpdateProfile": "فشل تحديث الملف الشخصي",
      "displayName": "اسم العرض",
      "placeholderEnterYourName": "أدخل أسمك",
      "email": "البريد الإلكتروني",
      "phone": "هاتف",
      "placeholderEnterPhoneNumber": "أدخل رقم هاتفك",
      "saveChanges": "حفظ التغييرات",
      "languageThai": "ไทย (Thai)",
      "languageEnglish": "English",
      "languageArabic": "العربية (Arabic)",
      "errorChangingLanguage": "خطأ في تغيير اللغة"
    }
  }
};

const i18nInitPromise = getStoredLanguage().then((storedLanguage) =>
  i18n
    .use(initReactI18next)
    .init({
      resources,
      lng: storedLanguage,
      fallbackLng: 'en',
      interpolation: { escapeValue: false }
    })
);

export { i18nInitPromise };
export default i18n;